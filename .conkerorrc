// -*- javascript -*-

/* ------------------------------------------------------------------------- */
/*                     Conkeror config file                                  */
/* ------------------------------------------------------------------------- */

/* ------------------- url completion --------------------------------------*/

url_completion_use_history = true;

/* mode-line widget config  ----------------------------------*/

/* ------------------- buffer count indicator ----------------------------------*/

// add_hook("mode_line_hook", mode_line_adder(buffer_count_widget), true);

/* ------------------- remove useless clock ----------------------------------*/

// remove_hook("mode_line_hook", mode_line_adder(clock_widget));

/* Displaying Favicons */

require("favicon");

/* ---------------- favicon in mode line */

// add_hook("mode_line_hook", mode_line_adder(buffer_icon_widget), true);

/* ---------------- favicon in mini buffer */

read_buffer_show_icons = true;

/* ---------------- display tabs */

require("new-tabs");
require("github");
require("gmail");
require("youtube");
require("youtube-player");
require("twitter");
require("duckduckgo");
require("google-calendar");
require("google-maps");

/* web jumps */

/* -------------- imdb */
/* type 'i your film' in the mini buffer to search 'your film'  on imdb*/

define_webjump("i", "http://imdb.com/find?q=%s");
define_webjump("g", "http://www.google.fr/search?q=%s");
define_webjump("w", "http://en.wikipedia.org?search=%s");

/* TODO : add :
   - w wikipedia
   - a amazon */

/* javascript injection (jquery) */
/*
To use this,

  M-x jquery-here
  jq: $("h1").css("backgroundColor", "blue");
  */
function install_jquery(d) {
    var script_el = d.createElementNS(XHTML_NS, "script");
    script_el.setAttribute("language", "javascript");
    script_el.setAttribute("type", "text/javascript");
    script_el.setAttribute("src", "http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js");
    d.body.appendChild(script_el);
}

function jquery_this_doc(d, js_code) {
    install_jquery(d);
    var script_el = d.createElementNS(XHTML_NS, "script");
    script_el.textContent = js_code;
    d.body.appendChild(script_el);
}

interactive("jquery-here",
            "load jquery.js into this page, then your command",
            function(I) {
                jquery_this_doc(I.buffer.document, (yield I.minibuffer.read($prompt = "jq: ", $history = "jquery-here")));
                // Providing a $history is what allows editing/replay of earlier commands
            });

// rebind global
define_key(default_global_keymap, "C-h", "go-back");

// new bindings
define_key(default_global_keymap, "C-w", "kill-current-buffer");

// rebound from global.js
define_key(default_global_keymap, "h", "find-url");
// Base binding for help (C-h by default)
define_key(default_global_keymap, "M-?", default_help_keymap);
define_key(default_global_keymap, "b", "switch-to-buffer");
define_key(default_global_keymap, "C-f", "isearch-forward");
// note, i had to comment out the "C-f" binding in basic-commands.js to make this work

// rebound from isearch.js
// define_key(isearch_keymap, "C-f", "isearch-continue-forward");

// rebound from normal.js
// define_key(content_buffer_normal_keymap, "back_space", "go-back");
// define_key(content_buffer_normal_keymap, "S-back_space", "go-forward");

// rebound from element.js
//define_key(content_buffer_normal_keymap, "k", "bookmark");

// rebound from basic-commands.js
// define_key(content_buffer_normal_keymap, "home","beginning-of-line");
// define_key(content_buffer_normal_keymap, "end","end-of-line");
// define_key(content_buffer_normal_keymap, "C-home","cmd_scrollTop");
// define_key(content_buffer_normal_keymap, "C-end","cmd_scrollBottom");

// Use `C-i` as tab
define_key(content_buffer_normal_keymap, "C-i", "browser-focus-next-form-field");
define_key(minibuffer_keymap, "C-i", "minibuffer-complete");
define_key(hint_keymap, "C-i", "hints-next");
define_key(google_gqueues_keymap, "C-i", null, $fallthrough);
define_key(gmail_keymap, "C-i", null, $fallthrough);
define_key(google_calendar_keymap, "C-i", null, $fallthrough);

define_key(content_buffer_normal_keymap, "S-C-i", "browser-focus-previous-form-field");
define_key(minibuffer_keymap, "S-C-i", "minibuffer-complete-previous");
define_key(hint_keymap, "S-C-i", "hints-previous");
define_key(google_gqueues_keymap, "S-C-i", null, $fallthrough);

// Use `C-m` as `return`
define_key(content_buffer_anchor_keymap, "C-m", "follow", $browser_object = browser_object_focused_element);
define_key(content_buffer_form_keymap, "C-m", null, $fallthrough);
define_key(content_buffer_select_keymap, "C-m", null, $fallthrough);
define_key(content_buffer_button_keymap, "C-m", "follow", $browser_object = browser_object_focused_element);
define_key(minibuffer_keymap, "C-m", "exit-minibuffer");
define_key(hint_keymap, "C-m", "hints-exit");
define_key(gmail_keymap, "C-m", null, $fallthrough);
define_key(twitter_keymap, "C-m", null, $fallthrough);
define_key(facebook_keymap, "C-m", null, $fallthrough);
define_key(google_search_results_keymap, "C-m", "ensure-content-focused", $fallthrough);//BAD
define_key(google_calendar_keymap, "C-m", null, $fallthrough);
define_key(duckduckgo_select_keymap, "C-m", "duckduckgo-follow-current");

// rebound from text.js
// define_key(content_buffer_text_keymap, "home", "cmd_beginLine");
// define_key(content_buffer_text_keymap, "end", "cmd_endLine");
// define_key(content_buffer_text_keymap, "C-left", "cmd_wordPrevious");
// define_key(content_buffer_text_keymap, "C-right", "cmd_wordNext");
// define_key(content_buffer_text_keymap, "C-y", "cmd_redo");
define_key(content_buffer_text_keymap, "C-/", "cmd_undo");
// define_key(content_buffer_text_keymap, "C-v", "cmd_paste");
// define_key(content_buffer_text_keymap, "C-x", "cmd_cut");
// define_key(content_buffer_text_keymap, "C-c", "cmd_copy");

// new for textarea.js
// define_key(content_buffer_textarea_keymap, "home", "cmd_beginLine");
// define_key(content_buffer_textarea_keymap, "end", "cmd_endLine");
// define_key(content_buffer_textarea_keymap, "C-left", "cmd_wordPrevious");
// define_key(content_buffer_textarea_keymap, "C-right", "cmd_wordNext");
// define_key(content_buffer_textarea_keymap, "C-y", "cmd_redo");
define_key(content_buffer_textarea_keymap, "C-/", "cmd_undo");
// define_key(content_buffer_textarea_keymap, "C-v", "cmd_paste");
// define_key(content_buffer_textarea_keymap, "C-x", "cmd_cut");
// define_key(content_buffer_textarea_keymap, "C-c", "cmd_copy");

// rebound for textarea.js
// define_key(content_buffer_textarea_keymap, "C-home", "cmd_moveTop");
// define_key(content_buffer_textarea_keymap, "C-end", "cmd_moveBottom");

// rebound from zoom.js
// define_key(content_buffer_normal_keymap, "C-subtract", "zoom-out-text");
// define_key(content_buffer_normal_keymap, "C-add", "zoom-in-text");

// webjumps
// add_delicious_webjumps ("saltycrane");
// add_webjump("g", "www.google.com/search?q=%s");
// add_webjump("d", "del.icio.us/saltycrane/%s");
// add_webjump("blank", "about:blank");
// add_webjump("reader", "www.google.com/reader");
